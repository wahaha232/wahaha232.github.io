<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>London Bus Tour Live Cam</title>
  <meta name="description" content="Watch a real-time London bus tour live stream, see city sights, weather updates, and more.">
  <meta name="keywords" content="London, live cam, bus tour, sightseeing, weather">

  <!-- Google Font for Handwritten Style -->
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Caveat', cursive;
      margin: 0;
      color: #333333;
      background: url('https://raw.githubusercontent.com/wahaha232/wahaha232.github.io/refs/heads/main/londonclassic.png') no-repeat center center fixed;
      background-size: cover;
    }
    body > * {
      background: rgba(245,245,230,0.85);
      backdrop-filter: blur(4px);
    }
    nav, header, main, footer { max-width: 1200px; margin: auto; padding: 1rem; }
    nav { display: flex; justify-content: flex-end; background: #5a5a5a; }
    nav a {
      color: #f5f5e6;
      margin: 0 10px;
      text-decoration: none;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
      font-weight: bold;
    }
    h1 {
      text-align: center;
      color: #444444;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
      font-size: 3em;
      font-weight: bold;
      margin: 0;
    }
    header p {
      text-align: center;
      margin: .5em 0 0;
      font-size: 1.2em;
    }
    .content-wrapper {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 1rem;
      padding: 1rem;
      max-width: 1200px;
    }
    .weather-card {
      width: 240px;
      background: #6b7280;
      color: #f5f5e6;
      padding: 1em;
      border-radius: 10px;
      border: 2px solid #444444;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      box-shadow: 3px 3px 5px rgba(0,0,0,0.2);
      min-height: 440px;
    }
    .weather-card > div {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      justify-content: center;
      align-items: center;
      width: 100%;
    }
    .weather-card h3 {
      margin: 0;
      font-size: 1.6em;
      text-align: center;
    }
    .weather-card p {
      margin: 0;
      font-size: 1.3em;
      line-height: 1.2;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .weather-card .datetime {
      font-size: 1.1em;
      line-height: 1.2;
      margin: 0;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .weather-animation {
      font-size: 3rem;
      animation: float 2s ease-in-out infinite;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    @keyframes float { 0%,100%{ transform: translateY(0); } 50%{ transform: translateY(-8px); } }
    .video-wrapper {
      flex: 1;
      width: 100%;
    }
    iframe {
      width: 100%;
      height: 440px;
      border: 2px solid #444444;
      border-radius: 8px;
    }
    .info {
      background: none; backdrop-filter: none;
      padding: 1.5em; margin: 20px auto;
      border-radius: 8px; text-align: center;
      font-size: 1.6em; font-weight: bold;
      max-width: 600px; line-height: 1.2em;
      color: #4a4a4a;
    }
    .info h2 { font-size: 2em; margin-bottom: .5em; }
    .info p { margin: .2em 0; }
    .info p strong { margin-right: 0.5em; }
    .info p a { margin-right: 1em; }
    .info .no-wrap { white-space: nowrap; } /* 防止換行 */
    .ads-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      margin: 20px auto;
      max-width: 1200px;
      background: none;
      backdrop-filter: none;
    }
    .ad-slot {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .visitor-counter {
      text-align: center;
      margin: 20px 0;
      font-size: 1.4em;
      color: #444444;
      background: none;
      backdrop-filter: none;
    }
    .visitor-counter a {
      font-family: 'Caveat', cursive;
    }
    .visitor-counter font {
      font-family: 'Caveat', cursive;
      font-size: 1em;
    }
    footer {
      text-align: center;
      padding: 1rem;
      color: #444444;
      font-size: 1.6em;
      background: none;
      backdrop-filter: none;
    }
  </style>
</head>
<body>
  <nav>
    <a href="index.html">Home</a>
    <a href="about.html">About</a>
    <a href="privacy.html">Privacy Policy</a>
  </nav>
  <header>
    <h1>London Bus Tour - Live Stream</h1>
    <p>Welcome to London! Experience the city’s iconic sights live on our virtual bus tour, anytime, anywhere.</p>
  </header>
  <main class="content-wrapper">
    <div class="weather-card">
      <div>
        <h3>London Weather</h3>
        <div id="weather-animation" class="weather-animation">☁️</div>
        <p>Temperature: <span id="weather-temp">--°C</span></p>
        <p>Feels Like: <span id="weather-feels">--°C</span></p>
        <p>Condition: <span id="weather-condition">--</span></p>
        <p>UV Index: <span id="weather-uv">--</span></p>
        <p>Sunrise: <span id="weather-sunrise">--:--</span></p>
        <p>Sunset: <span id="weather-sunset">--:--</span></p>
      </div>
      <div>
        <p class="datetime">Date: <span id="local-date">0000/00/00</span></p>
        <p class="datetime">Time: <span id="local-time">--:--:-- GMT</span></p>
      </div>
    </div>
    <div class="video-wrapper">
      <iframe src="https://www.youtube.com/embed/KSsfLxP-A9g?autoplay=1&mute=1" allowfullscreen></iframe>
    </div>
  </main>
  <div class="info">
    <h2>Visitor Info</h2>
    <p><strong>City:</strong> London, United Kingdom</p>
    <p><strong>Tour Type:</strong> Open-top sightseeing bus</p>
    <p><strong>Tour Schedule:</strong> Daily from 9 AM to 6 PM</p>
    <p><strong>Official Website:</strong> <a href="https://www.visitlondon.com/" target="_blank">Visit London</a></p>
    <p><strong>Airports:</strong>
       <a href="https://www.heathrow.com" target="_blank">Heathrow</a>
       <a href="https://www.gatwickairport.com" target="_blank">Gatwick</a>
    </p>
    <p><strong>Eurostar:</strong> <a href="https://www.eurostar.com" target="_blank">Eurostar</a></p>
    <p class="no-wrap"><strong>London Underground:</strong> <a href="https://tfl.gov.uk/modes/tube/" target="_blank">London Underground Website</a></p>
  </div>
  <div class="ads-container">
    <div class="ad-slot">
      <script async data-cfasync="false" src="//pl26441868.profitableratecpm.com/7d9bb8a39fc580ee58de14d8a8e63eab/invoke.js" onerror="console.log('Ad script failed to load');"></script>
      <div id="container-7d9bb8a39fc580ee58de14d8a8e63eab"></div>
    </div>
    <div class="ad-slot">
      <script async data-cfasync="false" src="//pl26441868.profitableratecpm.com/7d9bb8a39fc580ee58de14d8a8e63eab/invoke.js" onerror="console.log('Ad script failed to load');"></script>
      <div id="container-7d9bb8a39fc580ee58de14d8a8e63eab-2"></div>
    </div>
    <div class="ad-slot">
      <script async data-cfasync="false" src="//pl26441868.profitableratecpm.com/7d9bb8a39fc580ee58de14d8a8e63eab/invoke.js" onerror="console.log('Ad script failed to load');"></script>
      <div id="container-7d9bb8a39fc580ee58de14d8a8e63eab-3"></div>
    </div>
  </div>
  <div class="visitor-counter">
    <a href="https://cn.web-counter.net" title=""><img src="https://www.web-counter.net/count_20091204.php?c=1cTKaiN1EVX" style="border:0;padding:0;margin:0;" alt=""></a><br/><font size="1" face="Arial"><a href="https://cn.web-counter.net" title=""></a></font>
  </div>
  <footer>© 2025 London Bus Tour Live Cam</footer>

  <script>
    const lat = 51.5074, lon = -0.1278;
    let lastWeatherFetch = 0;
    let cachedWeatherData = null;

    function updateLocalTime() {
      console.log('Updating local time');
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      const dateElement = document.getElementById('local-date');
      const timeElement = document.getElementById('local-time');
      if (dateElement && timeElement) {
        dateElement.textContent = `${year}/${month}/${day}`;
        const opts = { timeZone: 'Europe/London', hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit', timeZoneName: 'short' };
        timeElement.textContent = now.toLocaleTimeString('en-GB', opts);
        console.log(`Updated date: ${dateElement.textContent}, time: ${timeElement.textContent}`);
      } else {
        console.error('Date or time element not found');
      }
    }

    async function fetchWeatherData() {
      try {
        const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,apparent_temperature,weather_code,uv_index&daily=sunrise,sunset&timezone=Europe/London`);
        if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
        const d = await res.json();

        const temp = d.current.temperature_2m;
        const feels_like = d.current.apparent_temperature;
        const uvi = d.current.uv_index;
        const weather_code = d.current.weather_code;
        const sunrise = d.daily.sunrise[0];
        const sunset = d.daily.sunset[0];

        return {
          temp,
          feels_like,
          uvi,
          weather_code,
          sunrise: new Date(sunrise).toLocaleTimeString('en-GB', { timeZone: 'Europe/London', hour12: false, hour: '2-digit', minute: '2-digit' }),
          sunset: new Date(sunset).toLocaleTimeString('en-GB', { timeZone: 'Europe/London', hour12: false, hour: '2-digit', minute: '2-digit' })
        };
      } catch (err) {
        console.error('Weather fetch failed:', err.message);
        return null;
      }
    }

    async function updateWeather() {
      const now = Date.now();
      // 快取 30 分鐘，避免過多請求
      if (cachedWeatherData && (now - lastWeatherFetch) < 1800000) {
        console.log('Using cached weather data');
      } else {
        console.log('Fetching new weather data');
        cachedWeatherData = await fetchWeatherData();
        lastWeatherFetch = now;
      }

      const d = cachedWeatherData;
      if (!d) {
        document.getElementById('weather-temp').textContent = '--°C';
        document.getElementById('weather-feels').textContent = '--°C';
        document.getElementById('weather-condition').textContent = 'N/A';
        document.getElementById('weather-uv').textContent = '--';
        document.getElementById('weather-sunrise').textContent = '--:--';
        document.getElementById('weather-sunset').textContent = '--:--';
        return;
      }

      document.getElementById('weather-temp').textContent = `${d.temp.toFixed(1)}°C`;
      document.getElementById('weather-feels').textContent = `${d.feels_like.toFixed(1)}°C`;
      document.getElementById('weather-uv').textContent = d.uvi.toFixed(1);
      document.getElementById('weather-sunrise').textContent = d.sunrise;
      document.getElementById('weather-sunset').textContent = d.sunset;

      // 根據 WMO 天氣碼判斷條件
      let cond = 'Clouds';
      let emoji = '☁️';
      if (d.weather_code === 0) {
        cond = 'Clear';
        emoji = '☀️';
      } else if ([1, 2, 3].includes(d.weather_code)) {
        cond = 'Clouds';
        emoji = '☁️';
      } else if ([51, 53, 55, 61, 63, 65, 80, 81, 82].includes(d.weather_code)) {
        cond = 'Rain';
        emoji = '🌧️';
      } else if ([71, 73, 75, 85, 86].includes(d.weather_code)) {
        cond = 'Snow';
        emoji = '❄️';
      }
      document.getElementById('weather-condition').textContent = cond;
      document.getElementById('weather-animation').textContent = emoji;
    }

    function updateVisitorCount() {
      let count = localStorage.getItem('visitorCount') || 0;
      count = parseInt(count) + 1;
      localStorage.setItem('visitorCount', count);
    }

    document.addEventListener('DOMContentLoaded', () => {
      console.log('DOMContentLoaded event fired');
      updateLocalTime();
      updateVisitorCount();
      updateWeather(); // 初次載入時獲取天氣數據
      setInterval(updateWeather, 1800000); // 每 30 分鐘檢查一次
      setInterval(updateLocalTime, 1000);
    });
  </script>
</body>
</html>